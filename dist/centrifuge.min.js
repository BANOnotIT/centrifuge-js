!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Centrifuge",[],t):"object"==typeof exports?exports.Centrifuge=t():e.Centrifuge=t()}(this,(function(){return function(){"use strict";var e={382:function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0}),t.Centrifuge=void 0;var n=u(s(187)),r=u(s(471)),i=s(147),o=s(853);function u(e){return e&&e.__esModule?e:{default:e}}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function a(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function l(e,t){if(t&&("object"===c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var _="timeout",d="connection closed",b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(v,e);var t,n,u,b,p=(u=v,b=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(u);if(b){var s=f(this).constructor;e=Reflect.construct(t,arguments,s)}else e=t.apply(this,arguments);return l(this,e)});function v(e,t){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),(s=p.call(this))._url=e,s._websocket=null,s._sockjs=null,s._isSockjs=!1,s._xmlhttprequest=null,s._binary=!1,s._methodType=null,s._pushType=null,s._encoder=null,s._decoder=null,s._status="disconnected",s._reconnect=!0,s._reconnecting=!1,s._transport=null,s._transportName=null,s._transportClosed=!0,s._messageId=0,s._clientID=null,s._refreshRequired=!1,s._subs={},s._serverSubs={},s._lastSeq={},s._lastGen={},s._lastOffset={},s._lastEpoch={},s._messages=[],s._isBatching=!1,s._isSubscribeBatching=!1,s._privateChannels={},s._numRefreshFailed=0,s._refreshTimeout=null,s._pingTimeout=null,s._pongTimeout=null,s._subRefreshTimeouts={},s._retries=0,s._callbacks={},s._latency=null,s._latencyStart=null,s._connectData=null,s._token=null,s._xhrID=0,s._xhrs={},s._dispatchPromise=Promise.resolve(),s._protocol="",s._config={protocol:"",protocolVersion:"v1",debug:!1,name:"js",version:"",websocket:null,sockjs:null,xmlhttprequest:null,minRetry:1e3,maxRetry:2e4,timeout:5e3,ping:!0,pingInterval:25e3,pongWaitTimeout:5e3,privateChannelPrefix:"$",onTransportClose:null,sockjsServer:null,sockjsTimeout:null,sockjsTransports:["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],refreshEndpoint:"/centrifuge/refresh",refreshHeaders:{},refreshParams:{},refreshData:{},refreshAttempts:null,refreshInterval:1e3,onRefreshFailed:null,onRefresh:null,subscribeEndpoint:"/centrifuge/subscribe",subscribeHeaders:{},subscribeParams:{},subRefreshInterval:1e3,onPrivateSubscribe:null,disableWithCredentials:!1},s._configure(t),s}return t=v,n=[{key:"setToken",value:function(e){this._token=e}},{key:"setConnectData",value:function(e){this._connectData=e}},{key:"setRefreshHeaders",value:function(e){this._config.refreshHeaders=e}},{key:"setRefreshParams",value:function(e){this._config.refreshParams=e}},{key:"setRefreshData",value:function(e){this._config.refreshData=e}},{key:"setSubscribeHeaders",value:function(e){this._config.subscribeHeaders=e}},{key:"setSubscribeParams",value:function(e){this._config.subscribeParams=e}},{key:"_ajax",value:function(e,t,n,r,i){var o,u=this,c="";for(var a in this._debug("sending AJAX request to",e,"with data",JSON.stringify(r)),o=null!==this._xmlhttprequest?new this._xmlhttprequest:s.g.XMLHttpRequest?new s.g.XMLHttpRequest:new s.g.ActiveXObject("Microsoft.XMLHTTP"),t)t.hasOwnProperty(a)&&(c.length>0&&(c+="&"),c+=encodeURIComponent(a)+"="+encodeURIComponent(t[a]));for(var h in c.length>0&&(c="?"+c),o.open("POST",e+c,!0),"withCredentials"in o&&(o.withCredentials=!this._config.disableWithCredentials),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type","application/json"),n)n.hasOwnProperty(h)&&o.setRequestHeader(h,n[h]);return o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var e,t=!1;try{e=JSON.parse(o.responseText),t=!0}catch(e){i({error:"Invalid JSON. Data was: "+o.responseText,status:200,data:null})}t&&i({data:e,status:200})}else u._log("wrong status code in AJAX response",o.status),i({status:o.status,data:null})},setTimeout((function(){return o.send(JSON.stringify(r))}),20),o}},{key:"_log",value:function(){(0,o.log)("info",arguments)}},{key:"_debug",value:function(){!0===this._config.debug&&(0,o.log)("debug",arguments)}},{key:"_websocketSupported",value:function(){return null!==this._config.websocket||!("function"!=typeof WebSocket&&"object"!==("undefined"==typeof WebSocket?"undefined":c(WebSocket)))}},{key:"_setFormat",value:function(e){if(!this._formatOverride(e)){if("protobuf"===e)throw new Error("not implemented by JSON only Centrifuge client â€“ use client with Protobuf");this._binary=!1,this._methodType=i.JsonMethodType,this._pushType=i.JsonPushType,this._encoder=new i.JsonEncoder,this._decoder=new i.JsonDecoder}}},{key:"_formatOverride",value:function(e){return!1}},{key:"_configure",value:function(e){if(!("Promise"in s.g))throw new Error("Promise polyfill required");if((0,o.extend)(this._config,e||{}),this._debug("centrifuge config",this._config),!this._url)throw new Error("url required");if((0,o.startsWith)(this._url,"ws")&&this._url.indexOf("format=protobuf")>-1||"protobuf"===this._config.protocol)this._setFormat("protobuf"),this._protocol="protobuf";else{if(""!==this._config.protocol&&"json"!==this._config.protocol)throw new Error("unsupported protocol "+this._config.protocol);this._setFormat("json")}if("v1"!==this._config.protocolVersion&&"v2"!==this._config.protocolVersion)throw new Error("unsupported protocol version "+this._config.protocolVersion);if((0,o.startsWith)(this._url,"http"))if(this._debug("client will try to connect to SockJS endpoint"),null!==this._config.sockjs)this._debug("SockJS explicitly provided in options"),this._sockjs=this._config.sockjs;else{if(void 0===s.g.SockJS)throw new Error("SockJS not found, use ws:// in url or include SockJS");this._debug("use globally defined SockJS"),this._sockjs=s.g.SockJS}else this._debug("client will connect to websocket endpoint");this._xmlhttprequest=this._config.xmlhttprequest}},{key:"_setStatus",value:function(e){this._status!==e&&(this._debug("Status",this._status,"->",e),this._status=e)}},{key:"_isDisconnected",value:function(){return"disconnected"===this._status}},{key:"_isConnecting",value:function(){return"connecting"===this._status}},{key:"_isConnected",value:function(){return"connected"===this._status}},{key:"_nextMessageId",value:function(){return++this._messageId}},{key:"_resetRetry",value:function(){this._debug("reset retries count to 0"),this._retries=0}},{key:"_getRetryInterval",value:function(){var e=(0,o.backoff)(this._retries,this._config.minRetry,this._config.maxRetry);return this._retries+=1,e}},{key:"_abortInflightXHRs",value:function(){for(var e in this._xhrs){try{this._xhrs[e].abort()}catch(e){this._debug("error aborting xhr",e)}delete this._xhrs[e]}}},{key:"_clearConnectedState",value:function(e){for(var t in this._clientID=null,this._stopPing(),this._callbacks)if(this._callbacks.hasOwnProperty(t)){var s=this._callbacks[t];clearTimeout(s.timeout);var n=s.errback;if(!n)continue;n({error:this._createErrorObject("disconnected")})}for(var r in this._callbacks={},this._subs)if(this._subs.hasOwnProperty(r)){var i=this._subs[r];e?(i._isSuccess()&&(i._triggerUnsubscribe(),i._recover=!0),i._shouldResubscribe()&&i._setSubscribing()):i._setUnsubscribed()}for(var o in this._abortInflightXHRs(),null!==this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),this._subRefreshTimeouts)this._subRefreshTimeouts.hasOwnProperty(o)&&this._subRefreshTimeouts[o]&&this._clearSubRefreshTimeout(o);this._subRefreshTimeouts={},this._reconnect||(this._subs={})}},{key:"_isTransportOpen",value:function(){return this._isSockjs?this._transport&&this._transport.transport&&this._transport.transport.readyState===this._transport.transport.OPEN:this._transport&&this._transport.readyState===this._transport.OPEN}},{key:"_transportSend",value:function(e){if(!e.length)return!0;if(!this._isTransportOpen()){for(var t in e){var s=t.id;if(s in this._callbacks){var n=this._callbacks[s];clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s],(0,n.errback)({error:this._createErrorObject(d,0)})}}return!1}return this._transport.send(this._encoder.encodeCommands(e)),!0}},{key:"_getSubProtocol",value:function(){return this._protocol?"centrifuge-"+this._protocol:""}},{key:"_setupTransport",value:function(){var e=this;if(this._isSockjs=!1,null!==this._sockjs){var t={transports:this._config.sockjsTransports};null!==this._config.sockjsServer&&(t.server=this._config.sockjsServer),null!==this._config.sockjsTimeout&&(t.timeout=this._config.sockjsTimeout),this._isSockjs=!0,this._transport=new this._sockjs(this._url,null,t)}else{if(!this._websocketSupported())return void this._debug("No Websocket support and no SockJS configured, can not connect");null!==this._config.websocket?this._websocket=this._config.websocket:this._websocket=WebSocket;var s=this._getSubProtocol();this._transport=""!==s?new this._websocket(this._url,s):new this._websocket(this._url),!0===this._binary&&(this._transport.binaryType="arraybuffer")}this._transport.onopen=function(){e._transportClosed=!1,e._isSockjs?(e._transportName="sockjs-"+e._transport.transport,e._transport.onheartbeat=function(){return e._restartPing()}):e._transportName="websocket";var t={};e._token&&(t.token=e._token),e._connectData&&(t.data=e._connectData),e._config.name&&(t.name=e._config.name),e._config.version&&(t.version=e._config.version);var s={},n=!1;for(var r in e._serverSubs)if(e._serverSubs.hasOwnProperty(r)&&e._serverSubs[r].recoverable){n=!0;var i={recover:!0};e._serverSubs[r].seq||e._serverSubs[r].gen?(e._serverSubs[r].seq&&(i.seq=e._serverSubs[r].seq),e._serverSubs[r].gen&&(i.gen=e._serverSubs[r].gen)):e._serverSubs[r].offset&&(i.offset=e._serverSubs[r].offset),e._serverSubs[r].epoch&&(i.epoch=e._serverSubs[r].epoch),s[r]=i}n&&(t.subs=s),e._latencyStart=new Date;var o={};"v2"===e._config.protocolVersion?o.connect=t:o.params=t,e._call(o).then((function(t){var s;s="v1"===e._config.protocolVersion?e._decoder.decodeCommandResult(e._methodType.CONNECT,t.reply.result):t.reply.connect,e._connectResponse(s,n),t.next&&t.next()}),(function(t){109===t.error.code&&(e._refreshRequired=!0),e._disconnect(6,"connect error",!0),t.next&&t.next()}))},this._transport.onerror=function(t){e._debug("transport level error",t)},this._transport.onclose=function(t){e._transportClosed=!0;var s=d,n=!0,r=0;if(t&&"code"in t&&t.code&&(r=t.code),t&&"reason"in t&&t.reason)try{var i=JSON.parse(t.reason);s=i.reason,n=i.reconnect}catch(e){s=t.reason,(r>=3500&&r<4e3||r>=4500&&r<5e3)&&(n=!1)}if(r<3e3&&(r=4,s="connection closed"),null!==e._config.onTransportClose){var o={event:t,reason:s,reconnect:n};"v2"===e._config.protocolVersion&&(o.code=r),e._config.onTransportClose(o)}if(e._disconnect(r,s,n),!0===e._reconnect){e._reconnecting=!0;var u=e._getRetryInterval();e._debug("reconnect after "+u+" milliseconds"),setTimeout((function(){!0===e._reconnect&&(e._refreshRequired?e._refresh():e._connect())}),u)}},this._transport.onmessage=function(t){e._dataReceived(t.data)}}},{key:"rpc",value:function(e){return this._rpc("",e)}},{key:"namedRPC",value:function(e,t){return this._rpc(e,t)}},{key:"_rpc",value:function(e,t){var s={data:t};""!==e&&(s.method=e);var n={};"v2"===this._config.protocolVersion?n.rpc=s:(n.method=this._methodType.RPC,n.params=s);var r=this;return this._methodCall(n,(function(e){return{data:("v1"===r._config.protocolVersion?r._decoder.decodeCommandResult(r._methodType.RPC,e.result):e.rpc).data}}))}},{key:"send",value:function(e){var t={data:e},s={};return"v2"===this._config.protocolVersion?s.send=t:(s.method=this._methodType.SEND,s.params=t),this.isConnected()&&this._transportSend([s])?Promise.resolve({}):Promise.reject(this._createErrorObject(d,0))}},{key:"_getHistoryRequest",value:function(e,t){var s={channel:e};return void 0!==t&&(t.since&&(s.since={offset:t.since.offset},t.since.epoch&&(s.since.epoch=t.since.epoch)),void 0!==t.limit&&(s.limit=t.limit),!0===t.reverse&&(s.reverse=!0)),s}},{key:"_methodCall",value:function(e,t){var s=this;return this.isConnected()?new Promise((function(n,r){s._call(e).then((function(e){n(t(e.reply)),e.next&&e.next()}),(function(e){r(e.error),e.next&&e.next()}))})):Promise.reject(this._createErrorObject(d,0))}},{key:"publish",value:function(e,t){var s={channel:e,data:t},n={};return"v2"===this._config.protocolVersion?n.publish=s:(n.method=this._methodType.PUBLISH,n.params=s),this._methodCall(n,(function(){return{}}))}},{key:"history",value:function(e,t){var s=this._getHistoryRequest(e,t),n={};"v2"===this._config.protocolVersion?n.history=s:(n.method=this._methodType.HISTORY,n.params=s);var r=this;return this._methodCall(n,(function(e){var t;return{publications:(t="v1"===r._config.protocolVersion?r._decoder.decodeCommandResult(r._methodType.HISTORY,e.result):e.history).publications,epoch:t.epoch||"",offset:t.offset||0}}))}},{key:"presence",value:function(e){var t={channel:e},s={};"v2"===this._config.protocolVersion?s.presence=t:(s.method=this._methodType.PRESENCE,s.params=t);var n=this;return this._methodCall(s,(function(e){return{presence:("v1"===n._config.protocolVersion?n._decoder.decodeCommandResult(n._methodType.PRESENCE,e.result):e.presence).presence}}))}},{key:"presenceStats",value:function(e){var t={channel:e},s={};return"v2"===this._config.protocolVersion?s.presence_stats=t:(s.method=this._methodType.PRESENCE_STATS,s.params=t),this._methodCall(s,(function(e){var t;return{num_users:(t="v1"===self._config.protocolVersion?self._decoder.decodeCommandResult(self._methodType.PRESENCE_STATS,e.result):e.presence_stats).num_users,num_clients:t.num_clients}}))}},{key:"_dataReceived",value:function(e){var t=this,s=this._decoder.decodeReplies(e);this._dispatchPromise=this._dispatchPromise.then((function(){var e;t._dispatchPromise=new Promise((function(t){e=t})),t._dispatchSynchronized(s,e)})),this._restartPing()}},{key:"_dispatchSynchronized",value:function(e,t){var s=this,n=Promise.resolve(),r=function(t){e.hasOwnProperty(t)&&(n=n.then((function(){return s._dispatchReply(e[t])})))};for(var i in e)r(i);n=n.then((function(){t()}))}},{key:"_dispatchReply",value:function(e){var t,s=new Promise((function(e){t=e}));if(null==e)return this._debug("dispatch: got undefined or null reply"),t(),s;var n=e.id;return n&&n>0?this._handleReply(e,t):"v1"===this._config.protocolVersion?this._handlePush(e.result,t):this._handlePushV2(e.push,t),s}},{key:"_call",value:function(e){var t=this;return new Promise((function(s,n){var r=t._addMessage(e);t._registerCall(r,s,n)}))}},{key:"_connect",value:function(){this.isConnected()?this._debug("connect called when already connected"):"connecting"!==this._status&&(this._debug("start connecting"),this._setStatus("connecting"),this._clientID=null,this._reconnect=!0,this._setupTransport())}},{key:"_disconnect",value:function(e,t,s){var n=s||!1;if(!1===n&&(this._reconnect=!1),this._isDisconnected())n||this._clearConnectedState(n);else{if(this._clearConnectedState(n),this._debug("disconnected:",t,s),this._setStatus("disconnected"),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),!1===this._reconnecting){for(var r in this._serverSubs)this._serverSubs.hasOwnProperty(r)&&this.emit("unsubscribe",{channel:r});var i={reason:t,reconnect:n};"v2"===this._config.protocolVersion&&(i.code=e),this.emit("disconnect",i)}!1===n&&(this._subs={},this._serverSubs={}),this._transportClosed||this._transport.close()}}},{key:"_refreshFailed",value:function(){this._numRefreshFailed=0,this._isDisconnected()||this._disconnect(7,"refresh failed",!1),null!==this._config.onRefreshFailed&&this._config.onRefreshFailed()}},{key:"_refresh",value:function(){var e=this;if(this._debug("refresh token"),0===this._config.refreshAttempts)return this._debug("refresh attempts set to 0, do not send refresh request at all"),void this._refreshFailed();null!==this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);var t=this._clientID,s=this._newXHRID(),n=function(n){if(s in e._xhrs&&delete e._xhrs[s],e._clientID===t)if(n.error||200!==n.status){if(n.error?e._debug("error refreshing connection token",n.error):e._debug("error refreshing connection token: wrong status code",n.status),e._numRefreshFailed++,null!==e._refreshTimeout&&(clearTimeout(e._refreshTimeout),e._refreshTimeout=null),null!==e._config.refreshAttempts&&e._numRefreshFailed>=e._config.refreshAttempts)return void e._refreshFailed();var r=Math.round(1e3*Math.random()*Math.max(e._numRefreshFailed,20)),i=e._config.refreshInterval+r;e._refreshTimeout=setTimeout((function(){return e._refresh()}),i)}else if(e._numRefreshFailed=0,e._token=n.data.token,e._token)if(e._isDisconnected()&&e._reconnect)e._debug("token refreshed, connect from scratch"),e._connect();else{e._debug("send refreshed token");var o={token:e._token},u={};"v2"===e._config.protocolVersion?u.refresh=o:(u.method=e._methodType.REFRESH,u.params=o);var c=e;e._call(u).then((function(t){var s;s="v1"===c._config.protocolVersion?c._decoder.decodeCommandResult(c._methodType.REFRESH,t.reply.result):t.reply.refresh,e._refreshResponse(s),t.next&&t.next()}),(function(t){e._refreshError(t.error),t.next&&t.next()}))}else e._refreshFailed()};if(null!==this._config.onRefresh)this._config.onRefresh({},n);else{var r=this._ajax(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,n);this._xhrs[s]=r}}},{key:"_refreshError",value:function(e){var t=this;this._debug("refresh error",e),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);var s=this._config.refreshInterval+Math.round(1e3*Math.random());this._refreshTimeout=setTimeout((function(){return t._refresh()}),s)}},{key:"_refreshResponse",value:function(e){var t=this;this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),e.expires&&(this._clientID=e.client,this._refreshTimeout=setTimeout((function(){return t._refresh()}),this._getTTLMilliseconds(e.ttl)))}},{key:"_newXHRID",value:function(){return this._xhrID++,this._xhrID}},{key:"_subRefresh",value:function(e){var t=this;if(this._debug("refresh subscription token for channel",e),void 0!==this._subRefreshTimeouts[e]){this._clearSubRefreshTimeout(e);var s=this._clientID,n=this._newXHRID(),r=function(r){if(n in t._xhrs&&delete t._xhrs[n],!r.error&&200===r.status&&t._clientID===s){var i={};if(r.data.channels)for(var o in r.data.channels){var u=r.data.channels[o];u.channel&&(i[u.channel]=u.token)}var c=i[e];if(c&&null!==t._getSub(e)){var a={channel:e,token:c},h={};"v2"===t._config.protocolVersion?h.sub_refresh=a:(h.method=t._methodType.SUB_REFRESH,h.params=a);var l=t;t._call(h).then((function(s){var n;n="v1"===l._config.protocolVersion?l._decoder.decodeCommandResult(l._methodType.SUB_REFRESH,s.reply.result):s.reply.sub_refresh,t._subRefreshResponse(e,n),s.next&&s.next()}),(function(s){t._subRefreshError(e,s.error),s.next&&s.next()}))}}},i={client:this._clientID,channels:[e]};if(null!==this._config.onPrivateSubscribe)this._config.onPrivateSubscribe({data:i},r);else{var o=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,i,r);this._xhrs[n]=o}}}},{key:"_clearSubRefreshTimeout",value:function(e){void 0!==this._subRefreshTimeouts[e]&&(clearTimeout(this._subRefreshTimeouts[e]),delete this._subRefreshTimeouts[e])}},{key:"_subRefreshError",value:function(e,t){var s=this;if(this._debug("subscription refresh error",e,t),this._clearSubRefreshTimeout(e),null!==this._getSub(e)){var n=Math.round(1e3*Math.random()),r=setTimeout((function(){return s._subRefresh(e)}),this._config.subRefreshInterval+n);this._subRefreshTimeouts[e]=r}}},{key:"_subRefreshResponse",value:function(e,t){var s=this;if(this._debug("subscription refresh success",e),this._clearSubRefreshTimeout(e),null!==this._getSub(e)&&!0===t.expires){var n=setTimeout((function(){return s._subRefresh(e)}),this._getTTLMilliseconds(t.ttl));this._subRefreshTimeouts[e]=n}}},{key:"_subscribe",value:function(e,t){var s=this;this._debug("subscribing on",e.channel);var n=e.channel;if(n in this._subs||(this._subs[n]=e),this.isConnected()){e._setSubscribing(t);var r={channel:n};if(e._subscribeData&&(r.data=e._subscribeData),(0,o.startsWith)(n,this._config.privateChannelPrefix))this._isSubscribeBatching?this._privateChannels[n]=!0:(this.startSubscribeBatching(),this._subscribe(e),this.stopSubscribeBatching());else{var i=e._needRecover();if(!0===i){r.recover=!0;var u=this._getLastSeq(n),c=this._getLastGen(n);if(u||c)u&&(r.seq=u),c&&(r.gen=c);else{var a=this._getLastOffset(n);a&&(r.offset=a)}var h=this._getLastEpoch(n);h&&(r.epoch=h)}var l={};"v2"===this._config.protocolVersion?l.subscribe=r:(l.method=this._methodType.SUBSCRIBE,l.params=r),this._call(l).then((function(e){var t;t="v1"===s._config.protocolVersion?s._decoder.decodeCommandResult(s._methodType.SUBSCRIBE,e.reply.result):e.reply.subscribe,s._subscribeResponse(n,i,t),e.next&&e.next()}),(function(e){s._subscribeError(n,e.error),e.next&&e.next()}))}}else e._setNew()}},{key:"_unsubscribe",value:function(e){if(delete this._subs[e.channel],delete this._lastOffset[e.channel],delete this._lastSeq[e.channel],delete this._lastGen[e.channel],this.isConnected()){var t={channel:e.channel},s={};"v2"===this._config.protocolVersion?s.unsubscribe=t:(s.method=this._methodType.UNSUBSCRIBE,s.params=t),this._addMessage(s)}}},{key:"_getTTLMilliseconds",value:function(e){return Math.min(1e3*e,2147483647)}},{key:"getSub",value:function(e){return this._getSub(e)}},{key:"_getSub",value:function(e){return this._subs[e]||null}},{key:"_isServerSub",value:function(e){return void 0!==this._serverSubs[e]}},{key:"_connectResponse",value:function(e,t){var s=this,n=this._reconnecting;if(this._reconnecting=!1,this._resetRetry(),this._refreshRequired=!1,!this.isConnected()){for(var r in null!==this._latencyStart&&(this._latency=(new Date).getTime()-this._latencyStart.getTime(),this._latencyStart=null),this._clientID=e.client,this._setStatus("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires&&(this._refreshTimeout=setTimeout((function(){return s._refresh()}),this._getTTLMilliseconds(e.ttl))),this.startBatching(),this.startSubscribeBatching(),this._subs)if(this._subs.hasOwnProperty(r)){var i=this._subs[r];i._shouldResubscribe()&&this._subscribe(i,n)}this.stopSubscribeBatching(),this.stopBatching(),this._startPing();var o={client:e.client,transport:this._transportName,latency:this._latency};e.data&&(o.data=e.data),this.emit("connect",o),e.subs&&this._processServerSubs(e.subs)}}},{key:"_processServerSubs",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var s=e[t],n={channel:t,isResubscribe:void 0!==this._serverSubs[t]};n=this._expandSubscribeContext(n,s),this.emit("subscribe",n)}for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(i.recovered){var o=i.publications;if(o&&o.length>0)for(var u in o.length>1&&(!o[0].offset||o[0].offset>o[1].offset)&&(o=o.reverse()),o)o.hasOwnProperty(u)&&this._handlePublication(r,o[u])}this._serverSubs[r]={seq:i.seq,gen:i.gen,offset:i.offset,epoch:i.epoch,recoverable:i.recoverable}}}},{key:"_stopPing",value:function(){null!==this._pongTimeout&&(clearTimeout(this._pongTimeout),this._pongTimeout=null),null!==this._pingTimeout&&(clearTimeout(this._pingTimeout),this._pingTimeout=null)}},{key:"_startPing",value:function(){var e=this;!0!==this._config.ping||this._config.pingInterval<=0||this.isConnected()&&(this._pingTimeout=setTimeout((function(){e.isConnected()?(e.ping(),e._pongTimeout=setTimeout((function(){e._disconnect(11,"no ping",!0)}),e._config.pongWaitTimeout)):e._stopPing()}),this._config.pingInterval))}},{key:"_restartPing",value:function(){this._stopPing(),this._startPing()}},{key:"_subscribeError",value:function(e,t){var s=this._getSub(e);s&&s._isSubscribing()&&(0!==t.code||t.message!==_?s._setSubscribeError(t):this._disconnect(10,"subscribe timeout",!0))}},{key:"_expandSubscribeContext",value:function(e,t){var s=!1;"recovered"in t&&(s=t.recovered),e.recovered=s;var n=!1;"positioned"in t&&(n=t.positioned);var r="";"epoch"in t&&(r=t.epoch);var i=0;return"offset"in t&&(i=t.offset),n&&(e.streamPosition={offset:i,epoch:r}),t.data&&(e.data=t.data),e}},{key:"_subscribeResponse",value:function(e,t,s){var n=this,r=this._getSub(e);if(r&&r._isSubscribing()){r._setSubscribeSuccess(s);var i=s.publications;if(i&&i.length>0)for(var o in i.length>=2&&!i[0].offset&&!i[1].offset&&(i=i.reverse()),i)i.hasOwnProperty(o)&&this._handlePublication(e,i[o]);if(!s.recoverable||t&&s.recovered||(this._lastSeq[e]=s.seq||0,this._lastGen[e]=s.gen||0,this._lastOffset[e]=s.offset||0),this._lastEpoch[e]=s.epoch||"",s.recoverable&&(r._recoverable=!0),!0===s.expires){var u=setTimeout((function(){return n._subRefresh(e)}),this._getTTLMilliseconds(s.ttl));this._subRefreshTimeouts[e]=u}}}},{key:"_handleReply",value:function(e,t){var s=e.id;if(s in this._callbacks){var n=this._callbacks[s];if(clearTimeout(this._callbacks[s].timeout),delete this._callbacks[s],(0,o.errorExists)(e)){var r=n.errback;if(!r)return void t();r({error:e.error,next:t})}else{var i=n.callback;if(!i)return;i({reply:e,next:t})}}else t()}},{key:"_handleJoin",value:function(e,t){var s={info:t.info},n=this._getSub(e);n?n.emit("join",s):this._isServerSub(e)&&(s.channel=e,this.emit("join",s))}},{key:"_handleLeave",value:function(e,t){var s={info:t.info},n=this._getSub(e);n?n.emit("leave",s):this._isServerSub(e)&&(s.channel=e,this.emit("leave",s))}},{key:"_handleUnsub",value:function(e,t){var s={},n=this._getSub(e);n?(n.unsubscribe(),!0===t.resubscribe&&n.subscribe()):this._isServerSub(e)&&(delete this._serverSubs[e],s.channel=e,this.emit("unsubscribe",s))}},{key:"_handleSub",value:function(e,t){this._serverSubs[e]={seq:t.seq,gen:t.gen,offset:t.offset,epoch:t.epoch,recoverable:t.recoverable};var s={channel:e,isResubscribe:!1};s=this._expandSubscribeContext(s,t),this.emit("subscribe",s)}},{key:"_handlePublication",value:function(e,t){var s=this._getSub(e),n={data:t.data,seq:t.seq,gen:t.gen,offset:t.offset};t.info&&(n.info=t.info),t.meta&&(n.meta=t.meta),s?(void 0!==t.seq&&(this._lastSeq[e]=t.seq),void 0!==t.gen&&(this._lastGen[e]=t.gen),void 0!==t.offset&&(this._lastOffset[e]=t.offset),s.emit("publish",n)):this._isServerSub(e)&&(void 0!==t.seq&&(this._serverSubs[e].seq=t.seq),void 0!==t.gen&&(this._serverSubs[e].gen=t.gen),void 0!==t.offset&&(this._serverSubs[e].offset=t.offset),n.channel=e,this.emit("publish",n))}},{key:"_handleMessage",value:function(e){this.emit("message",e.data)}},{key:"_handlePush",value:function(e,t){var s=this._decoder.decodePush(e),n=0;"type"in s&&(n=s.type);var r=s.channel;if(n===this._pushType.PUBLICATION){var i=this._decoder.decodePushData(this._pushType.PUBLICATION,s.data);this._handlePublication(r,i)}else if(n===this._pushType.MESSAGE){var o=this._decoder.decodePushData(this._pushType.MESSAGE,s.data);this._handleMessage(o)}else if(n===this._pushType.JOIN){var u=this._decoder.decodePushData(this._pushType.JOIN,s.data);this._handleJoin(r,u)}else if(n===this._pushType.LEAVE){var c=this._decoder.decodePushData(this._pushType.LEAVE,s.data);this._handleLeave(r,c)}else if(n===this._pushType.UNSUBSCRIBE){var a=this._decoder.decodePushData(this._pushType.UNSUBSCRIBE,s.data);this._handleUnsub(r,a)}else if(n===this._pushType.SUBSCRIBE){var h=this._decoder.decodePushData(this._pushType.UNSUBSCRIBE,s.data);this._handleSub(r,h)}t()}},{key:"_handlePushV2",value:function(e,t){var s=e.channel;e.pub?this._handlePublication(s,e.pub):e.message?this._handleMessage(e.message):e.join?this._handleJoin(s,e.join):e.leave?this._handleLeave(s,e.leave):e.unsubscribe?this._handleUnsub(s,e.unsubscribe):e.subscribe&&this._handleSub(s,e.subscribe),t()}},{key:"_flush",value:function(){var e=this._messages.slice(0);this._messages=[],this._transportSend(e)}},{key:"_ping",value:function(){var e=this,t={};"v2"===this._config.protocolVersion||(t.method=this._methodType.PING),this._call(t).then((function(t){e._pingResponse(e._decoder.decodeCommandResult(e._methodType.PING,t.result)),t.next&&t.next()}),(function(t){e._debug("ping error",t.error),t.next&&t.next()}))}},{key:"_pingResponse",value:function(e){this.isConnected()&&(this._stopPing(),this._startPing())}},{key:"_getLastSeq",value:function(e){return this._lastSeq[e]||0}},{key:"_getLastOffset",value:function(e){return this._lastOffset[e]||0}},{key:"_getLastGen",value:function(e){return this._lastGen[e]||0}},{key:"_getLastEpoch",value:function(e){return this._lastEpoch[e]||""}},{key:"_createErrorObject",value:function(e,t){return{message:e,code:t||0}}},{key:"_registerCall",value:function(e,t,s){var n=this;this._callbacks[e]={callback:t,errback:s,timeout:null},this._callbacks[e].timeout=setTimeout((function(){delete n._callbacks[e],(0,o.isFunction)(s)&&s({error:n._createErrorObject(_)})}),this._config.timeout)}},{key:"_addMessage",value:function(e){var t=this._nextMessageId();return e.id=t,!0===this._isBatching?this._messages.push(e):this._transportSend([e]),t}},{key:"isConnected",value:function(){return this._isConnected()}},{key:"connect",value:function(){this._connect()}},{key:"disconnect",value:function(){this._disconnect(0,"client",!1)}},{key:"ping",value:function(){return this._ping()}},{key:"startBatching",value:function(){this._isBatching=!0}},{key:"stopBatching",value:function(){this._isBatching=!1,this._flush()}},{key:"startSubscribeBatching",value:function(){this._isSubscribeBatching=!0}},{key:"stopSubscribeBatching",value:function(){var e=this;this._isSubscribeBatching=!1;var t=this._privateChannels;this._privateChannels={};var s=[];for(var n in t)if(t.hasOwnProperty(n)){if(!this._getSub(n))continue;s.push(n)}if(0!==s.length){var r={client:this._clientID,channels:s},i=this._clientID,o=this._newXHRID(),u=function(t){if(o in e._xhrs&&delete e._xhrs[o],e._clientID===i)if(t.error||200!==t.status){for(var n in e._debug("authorization request failed"),s)if(s.hasOwnProperty(n)){var r=s[n];e._subscribeError(r,e._createErrorObject("authorization request failed"))}}else{var u={};if(t.data.channels)for(var c in t.data.channels){var a=t.data.channels[c];a.channel&&(u[a.channel]=a.token)}var h=!1;for(var l in e._isBatching||(e.startBatching(),h=!0),s)if(s.hasOwnProperty(l)){var f=function(){var t=s[l],n=u[t];if(!n)return e._subscribeError(t,e._createErrorObject("permission denied",103)),"continue";var r=e._getSub(t);if(null===r)return"continue";var i={channel:t,token:n},o=r._needRecover();if(!0===o){i.recover=!0;var c=e._getLastSeq(t),a=e._getLastGen(t);if(c||a)c&&(i.seq=c),a&&(i.gen=a);else{var h=e._getLastOffset(t);h&&(i.offset=h)}var f=e._getLastEpoch(t);f&&(i.epoch=f)}var _={};"v2"===e._config.protocolVersion?_.subscribe=i:(_.method=e._methodType.SUBSCRIBE,_.params=i),e._call(_).then((function(s){var n;n="v1"===e._config.protocolVersion?e._decoder.decodeCommandResult(e._methodType.SUBSCRIBE,s.reply.result):s.reply.subscribe,e._subscribeResponse(t,o,n),s.next&&s.next()}),(function(s){e._subscribeError(t,s.error),s.next&&s.next()}))}();if("continue"===f)continue}h&&e.stopBatching()}};if(null!==this._config.onPrivateSubscribe)this._config.onPrivateSubscribe({data:r},u);else{var c=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,r,u);this._xhrs[o]=c}}else this._debug("no private channels found, no need to make request")}},{key:"_setSubscribeSince",value:function(e,t){this._lastOffset[e.channel]=t.offset,this._lastEpoch[e.channel]=t.epoch,e._setNeedRecover(!0)}},{key:"subscribe",value:function(e,t,s){var n=this._getSub(e);if(null!==n)return n._setEvents(t),n._isUnsubscribed()&&n.subscribe(s),n;var i=new r.default(this,e,t);return this._subs[e]=i,i.subscribe(s),i}}],n&&a(t.prototype,n),v}(n.default);t.Centrifuge=b},579:function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(382).Centrifuge;t.default=n,e.exports=t.default},147:function(e,t){function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e}Object.defineProperty(t,"__esModule",{value:!0}),t.JsonPushType=t.JsonMethodType=t.JsonEncoder=t.JsonDecoder=void 0,t.JsonMethodType={CONNECT:0,SUBSCRIBE:1,UNSUBSCRIBE:2,PUBLISH:3,PRESENCE:4,PRESENCE_STATS:5,HISTORY:6,PING:7,SEND:8,RPC:9,REFRESH:10,SUB_REFRESH:11},t.JsonPushType={PUBLICATION:0,JOIN:1,LEAVE:2,UNSUBSCRIBE:3,MESSAGE:4,SUBSCRIBE:5};var i=function(){function e(){s(this,e)}return r(e,[{key:"encodeCommands",value:function(e){return e.map((function(e){return JSON.stringify(e)})).join("\n")}}]),e}();t.JsonEncoder=i;var o=function(){function e(){s(this,e)}return r(e,[{key:"decodeReplies",value:function(e){return e.split("\n").filter((function(e){return""!==e})).map((function(e){return JSON.parse(e)}))}},{key:"decodeCommandResult",value:function(e,t){return t}},{key:"decodePush",value:function(e){return e}},{key:"decodePushData",value:function(e,t){return t}}]),e}();t.JsonDecoder=o},471:function(e,t,s){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=s(187))&&r.__esModule?r:{default:r},o=s(853);function u(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function a(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(l,e);var t,s,n,r,i=(n=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(n);if(r){var s=h(this).constructor;e=Reflect.construct(t,arguments,s)}else e=t.apply(this,arguments);return a(this,e)});function l(e,t,s){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=i.call(this)).channel=t,n._centrifuge=e,n._status=0,n._error=null,n._isResubscribe=!1,n._ready=!1,n._subscriptionPromise=null,n._noResubscribe=!1,n._recoverable=!1,n._recover=!1,n._setEvents(s),n._initializePromise(),n._promises={},n._promiseId=0,n._subscribeData=null,n._autoResubscribeErrorCodes=[],n._autoResubscribeMinDelay=500,n._autoResubscribeMaxDelay=2e4,n._resubscribeTimeout=null,n._resubscribeAttempts=0,n.on("error",(function(e){this._centrifuge._debug("subscription error",e)})),n}return t=l,(s=[{key:"_nextPromiseId",value:function(){return++this._promiseId}},{key:"_initializePromise",value:function(){var e=this;this._ready=!1,this._subscriptionPromise=new Promise((function(t,s){e._resolve=function(s){e._ready=!0,t(s)},e._reject=function(t){e._ready=!0,s(t)}})).then((function(){}),(function(){}))}},{key:"_setNeedRecover",value:function(e){this._recoverable=e,this._recover=e}},{key:"_needRecover",value:function(){return!0===this._recoverable&&!0===this._recover}},{key:"_setEvents",value:function(e){if(e)if((0,o.isFunction)(e))this.on("publish",e);else if(Object.prototype.toString.call(e)===Object.prototype.toString.call({}))for(var t=["publish","join","leave","unsubscribe","subscribe","error"],s=0,n=t.length;s<n;s++){var r=t[s];r in e&&this.on(r,e[r])}}},{key:"_isNew",value:function(){return 0===this._status}},{key:"_isUnsubscribed",value:function(){return 4===this._status}},{key:"_isSubscribing",value:function(){return 1===this._status}},{key:"_isReady",value:function(){return 2===this._status||3===this._status}},{key:"_isSuccess",value:function(){return 2===this._status}},{key:"_isError",value:function(){return 3===this._status}},{key:"_setNew",value:function(){this._status=0}},{key:"_setSubscribing",value:function(e){this._isResubscribe=e||!1,!0===this._ready&&this._initializePromise(),this._status=1}},{key:"_setSubscribeSuccess",value:function(e){if(2!==this._status){this._status=2,this._resubscribeAttempts=0;var t=this._getSubscribeSuccessContext(e);for(var s in this._recover=!1,this.emit("subscribe",t),this._resolve(t),this._promises)clearTimeout(this._promises[s].timeout),this._promises[s].resolve(),delete this._promises[s]}}},{key:"_setSubscribeError",value:function(e){if(3!==this._status){this._status=3,this._error=e;var t=this._getSubscribeErrorContext();for(var s in this.emit("error",t),this._reject(t),this._promises)clearTimeout(this._promises[s].timeout),this._promises[s].reject(e),delete this._promises[s];if(this._autoResubscribeErrorCodes.indexOf(e.code)>-1){this._resubscribeAttempts++;var n=this,r=Math.round(Math.random()*this._autoResubscribeMinDelay);this._resubscribeTimeout=setTimeout((function(){n.subscribe()}),Math.min(this._autoResubscribeMaxDelay,Math.pow(this._resubscribeAttempts,2)*this._autoResubscribeMinDelay+r))}}}},{key:"_triggerUnsubscribe",value:function(){this.emit("unsubscribe",{channel:this.channel})}},{key:"_setUnsubscribed",value:function(e){if(this._resubscribeAttempts=0,clearTimeout(this._resubscribeTimeout),this._centrifuge._clearSubRefreshTimeout(this.channel),4!==this._status){var t=2===this._status;this._status=4,!0===e&&(this._recover=!1,this._noResubscribe=!0,delete this._centrifuge._lastSeq[this.channel],delete this._centrifuge._lastGen[this.channel],delete this._centrifuge._lastEpoch[this.channel]),t&&this._triggerUnsubscribe()}}},{key:"_shouldResubscribe",value:function(){return!this._noResubscribe}},{key:"_getSubscribeSuccessContext",value:function(e){var t={channel:this.channel,isResubscribe:this._isResubscribe};return e&&(t=this._centrifuge._expandSubscribeContext(t,e)),t}},{key:"_getSubscribeErrorContext",value:function(){var e=this._error;return e.channel=this.channel,e.isResubscribe=this._isResubscribe,e}},{key:"_setSubscribeData",value:function(e){this._subscribeData=e}},{key:"_setAutoResubscribe",value:function(e){this._autoResubscribeErrorCodes=e.autoResubscribeErrorCodes,e.autoResubscribeMinDelay&&(this._autoResubscribeMinDelay=e.autoResubscribeMinDelay),e.autoResubscribeMaxDelay&&(this._autoResubscribeMaxDelay=e.autoResubscribeMaxDelay)}},{key:"ready",value:function(e,t){this._ready&&(this._isSuccess()?e(this._getSubscribeSuccessContext()):t(this._getSubscribeErrorContext()))}},{key:"subscribe",value:function(e){2!==this._status&&(e&&e.since&&this._centrifuge._setSubscribeSince(this,e.since),e&&e.data&&this._setSubscribeData(e.data),e&&e.autoResubscribeErrorCodes&&e.autoResubscribeErrorCodes.length>0&&this._setAutoResubscribe(e),this._noResubscribe=!1,this._centrifuge._subscribe(this))}},{key:"unsubscribe",value:function(){this._setUnsubscribed(!0),this._centrifuge._unsubscribe(this)}},{key:"_methodCall",value:function(){var e=this;return this._isSuccess()?Promise.resolve():this._isError()?Promise.reject(this._error):new Promise((function(t,s){var n=setTimeout((function(){s({code:0,message:"timeout"})}),e._centrifuge._config.timeout);e._promises[e._nextPromiseId()]={timeout:n,resolve:t,reject:s}}))}},{key:"publish",value:function(e){var t=this;return this._methodCall().then((function(){return t._centrifuge.publish(t.channel,e)}))}},{key:"presence",value:function(){var e=this;return this._methodCall().then((function(){return e._centrifuge.presence(e.channel)}))}},{key:"presenceStats",value:function(){var e=this;return this._methodCall().then((function(){return e._centrifuge.presenceStats(e.channel)}))}},{key:"history",value:function(e){var t=this;return this._methodCall().then((function(){return t._centrifuge.history(t.channel,e)}))}}])&&u(t.prototype,s),l}(i.default);t.default=l,e.exports=t.default},853:function(e,t,s){function n(e){return null!=e&&"function"==typeof e}Object.defineProperty(t,"__esModule",{value:!0}),t.backoff=function(e,t,s){var n=.5*Math.random(),r=Math.min(s,t*Math.pow(2,e+1));return Math.floor((1-n)*r)},t.errorExists=function(e){return"error"in e&&null!==e.error},t.extend=function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e},t.isFunction=n,t.log=function(e,t){if(s.g.console){var r=s.g.console[e];n(r)&&r.apply(s.g.console,t)}},t.startsWith=function(e,t){return 0===e.lastIndexOf(t,0)}},187:function(e){var t,s="object"==typeof Reflect?Reflect:null,n=s&&"function"==typeof s.apply?s.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)};t=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(s,n){function r(s){e.removeListener(t,i),n(s)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",r),s([].slice.call(arguments))}b(e,t,i,{once:!0}),"error"!==t&&function(e,t,s){"function"==typeof e.on&&b(e,"error",t,{once:!0})}(e,r)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function a(e,t,s,n){var r,i,o,a;if(u(s),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),i=e._events),o=i[t]),void 0===o)o=i[t]=s,++e._eventsCount;else if("function"==typeof o?o=i[t]=n?[s,o]:[o,s]:n?o.unshift(s):o.push(s),(r=c(e))>0&&o.length>r&&!o.warned){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=o.length,a=h,console&&console.warn&&console.warn(a)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,s){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:s},r=h.bind(n);return r.listener=s,n.wrapFn=r,r}function f(e,t,s){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?s?[r.listener||r]:[r]:s?function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(r):d(r,r.length)}function _(e){var t=this._events;if(void 0!==t){var s=t[e];if("function"==typeof s)return 1;if(void 0!==s)return s.length}return 0}function d(e,t){for(var s=new Array(t),n=0;n<t;++n)s[n]=e[n];return s}function b(e,t,s,n){if("function"==typeof e.on)n.once?e.once(t,s):e.on(t,s);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(i){n.once&&e.removeEventListener(t,r),s(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var u=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw u.context=o,u}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var a=c.length,h=d(c,a);for(s=0;s<a;++s)n(h[s],this,t)}return!0},i.prototype.addListener=function(e,t){return a(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return a(this,e,t,!0)},i.prototype.once=function(e,t){return u(t),this.on(e,l(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,l(this,e,t)),this},i.prototype.removeListener=function(e,t){var s,n,r,i,o;if(u(t),void 0===(n=this._events))return this;if(void 0===(s=n[e]))return this;if(s===t||s.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(r=-1,i=s.length-1;i>=0;i--)if(s[i]===t||s[i].listener===t){o=s[i].listener,r=i;break}if(r<0)return this;0===r?s.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(s,r),1===s.length&&(n[e]=s[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,s,n;if(void 0===(s=this._events))return this;if(void 0===s.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==s[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete s[e]),this;if(0===arguments.length){var r,i=Object.keys(s);for(n=0;n<i.length;++n)"removeListener"!==(r=i[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return f(this,e,!0)},i.prototype.rawListeners=function(e){return f(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},i.prototype.listenerCount=_,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}return s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s(579)}()}));
//# sourceMappingURL=centrifuge.min.js.map